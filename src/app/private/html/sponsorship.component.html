<app-common-top-bar active="sponsorship"></app-common-top-bar>

<div class="modal fade" id="sponsorshipGive" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{'Give drachmas to { value }'| translate : { value: currentPlayer.username } }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" 
                aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center" (click)="setGift()">
          {{'{ value } can still receive { qtt } Drachmas'| translate: { value: currentPlayer.username, qtt: currentPlayer.remain| number:'': this.translate.currentLang } }}
        </div>
    
        <br/>
        <div *ngIf="giftsError > 0" class="text-center">
          <div class="alert alert-danger" *ngIf="giftsError === 1" translate>
            You can't give Drachmas to this member.
          </div>
          <div class="alert alert-danger" *ngIf="giftsError === 2" translate>
            You don't have enough Drachmas.
          </div>
          <div class="alert alert-danger" *ngIf="giftsError === 3" translate>
            You can't give as much drachmas to this member.
          </div>
          <div class="alert alert-success" *ngIf="giftsError === 4" translate>
            Don completed successfully.
          </div>
          <br/>
        </div>
    
        <input type="number" class="form-control" placeholder="0" 
                [attr.min]="0" [attr.max]="currentPlayer.remain" [(ngModel)]="qttGiftsRess">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary"
                data-bs-dismiss="modal" translate>Close</button>
        <button type="button" class="btn btn-primary" (click)="confirm()"
                *ngIf="currentPlayer.remain > 0"
                translate>Confirm</button>
      </div>
    </div>
  </div>
</div>

<div class="home-bg home-bg-private">
  <div class="col-lg-10 col-md-10 col-sm-12 col-12 main main-top" role="main">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-body table-responsive">
              <h2 class="text-center" id="sponsorListDesc" translate>Sponsorship</h2>
              <div class="text-center" translate>Donation limits are per day</div>
              <br/>

              <table class="table table-striped table-middle align-middle"
                      aria-labelledby="sponsorListDesc" *ngIf="sponsorList.length === 0">
                <thead>
                  <tr>
                    <th scope="col" translate>Player</th>
                    <th scope="col" class="d-none d-sm-table-cell" translate>Field</th>
                    <th scope="col" translate>Alliance</th>
                    <th scope="col" translate>Activity</th>
                    <th scope="col" translate>Donations</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let p of sponsorList">
                    <th scope="row" class="fw-normal">
                      {{ p.username }} ({{ p.level }})
                    </th>
                    <td class="d-none d-sm-table-cell text-end">{{ p.field | number:'': this.translate.currentLang }}</td>
                    <td>
                      <a [routerLink]="['/allianceprofile/'+p.alliance]">
                        {{p.alliance_name}}
                      </a>
                      <span *ngIf="p.alliance === 0" translate>None</span>
                    </td>
                    <td>
                      <span [ngSwitch]="p.activity">
                        <span *ngSwitchCase="1" translate>Today</span>
                        <span *ngSwitchCase="2">{{'Last { value } days' | translate : { value : 3 } }} </span>
                        <span *ngSwitchCase="3">{{'Last { value } days' | translate : { value : 7 } }} </span>
                        <span *ngSwitchCase="4">{{'Last { value } days' | translate : { value : 30 } }} </span>
                        <span *ngSwitchCase="5" translate>More than 30 days</span>
                        <span *ngSwitchDefault>{{p.activity}}</span>
                      </span>
                    </td>
                    <td>{{ p.gift | number:'': this.translate.currentLang }}/{{ p.gift+p.remain | number:'': this.translate.currentLang }}</td>
                    <td class="text-center">
                      <button class="btn" data-bs-toggle="modal" data-bs-target="#sponsorshipGive"
                              [ngClass]="{'btn-success': p.gift === 0, 'btn-danger': p.remain === 0, 'btn-warning': p.gift > 0 && p.remain > 0}"
                              (click)="selectPlayer(p)" title="{{'Give drachmas'|translate}}">
                        <app-ic-icon [icon]="coinBagSolid"></app-ic-icon>
                        <span class="visually-hidden">
                          {{'Give drachmas'|translate}}
                        </span>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="text-center" *ngIf="sponsorList.length >= 0" translate>
                You haven't sponsored any player
              </div>
              <div class="text-center">
                <br/>
                <a class="link" [routerLink]="['/options']" translate>Back</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-connected-right-menu></app-connected-right-menu>
</div>

<app-common-bottom-bar></app-common-bottom-bar>
