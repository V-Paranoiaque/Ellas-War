<common-top-bar active="diplomacy"></common-top-bar>

<div class="modal fade" id="AllianceCreate" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <alliance-create-popup></alliance-create-popup>
  </div>
</div>

<div class="modal fade" id="AlliancePactAsk" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <alliance-pact-ask-popup [info]="allianceProfile"></alliance-pact-ask-popup>
  </div>
</div>
<div class="modal fade" id="AlliancePactManage" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <alliance-pact-manage-popup [info]="allianceProfile"></alliance-pact-manage-popup>
  </div>
</div>

<div class="modal fade" id="AllianceJoin" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <alliance-join-popup [info]="allianceProfile"></alliance-join-popup>
  </div>
</div>

<div class="modal fade" id="AllianceWarDeclare" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <alliance-war-declare-popup [info]="allianceProfile"></alliance-war-declare-popup>
  </div>
</div>

<div class="col-lg-10 col-md-10 col-sm-12 col-xs-12 main">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <div class="card">
          <div class="card-body">
            <div class="text-center fw-bold text-danger"
                 *ngIf="user.info.datas && user.info.datas.alliance && 
                        user.getPropertyNb('alliance') == 0 && 
                        user.getPropertyNb('level') >= user.info.datas.alliance.create">
              <a data-bs-toggle="modal" data-bs-target="#AllianceCreate" role="button" translate>
                Create an alliance
              </a>
              <br/>
            </div>
            
            <div *ngIf="allianceWait && allianceWait.alliance_name" class="text-center text-danger"><br/>
              {{'Waiting in the alliance { value }'| translate: {value: allianceWait.alliance_name } }}
              <span (click)="allianceWaitCancel()" role="button">
                (<span translate>Cancel</span>)
              </span>
              <br/>
            </div>
            
            <div class="text-center fw-bold text-danger"
                 *ngIf="user.info.datas && user.getPropertyNb('strategist') >0 && 
                        user.getPropertyNb('alliance') > 0 && 
                        user.getPropertyNb('nbmembers') < user.info.datas.war.minmembers">
              {{'To start wars, your alliance must have at least { value } members.'| translate:{ value: user.info.datas.war.minmembers } }}
              <br/>
            </div>
            
            <div class="visually-hidden" id="allianceListDesc"
                 translate>List of the alliances</div>
            <table class="table table-striped table-middle align-middle"
                   *ngIf="allianceList" aria-labelledby="allianceListDesc">
              <thead>
                <tr>
                  <th (click)="allianceListOrder('mbs')" scope="col"
                      class="text-center">
                    <span class="fa fa-users "></span>
                  </th>
                  <th (click)="allianceListOrder('name')" scope="col"
                      translate>Name</th>
                  <th (click)="allianceListOrder('chief')" scope="col"
                      class="d-none d-sm-table-cell" translate>Chief</th>
                  <th (click)="allianceListOrder('victories')" scope="col"
                      translate>V</th>
                  <th (click)="allianceListOrder('defeats')" scope="col"
                      translate>D</th>
                  <th scope="col">
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let alli of allianceList">
                  <td class="text-center">
                    <a class="link" [routerLink]="['/alliancemembers/'+alli.alliance_id]">
                      {{alli.nbmembers}}
                    </a>
                  </td>
                  <td>
                    <a [routerLink]="['/allianceprofile/'+alli.alliance_id]">
                      {{alli.alliance_name}}
                    </a>
                    <div class="d-block d-sm-none">
                      <a [routerLink]="['/profile/'+alli.chief_id]">
                        {{alli.username}}
                      </a>
                    </div>
                  </td>
                  <td class="d-none d-sm-table-cell">
                    <a [routerLink]="['/profile/'+alli.chief_id]">
                      {{alli.username}}
                    </a>
                  </td>
                  <td>{{alli.victories | number:'': this.translate.currentLang}}</td>
                  <td>{{alli.defeats | number:'': this.translate.currentLang}}</td>
                  <td class="text-center">
                    <a class="btn btn-primary"
                       [routerLink]="['/alliancemembers/'+alli.alliance_id]"
                       title="{{'Alliance members:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="users"></ic-icon>
                      <span class="visually-hidden">
                        {{'Alliance members:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-info"
                       [routerLink]="['/allianceprofile/'+alli.alliance_id]"
                       title="{{'Alliance profile'|translate}}{{':'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="fileAlt"></ic-icon>
                      <span class="visually-hidden">
                        {{'Alliance profile'|translate}}{{':'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    
                    <a class="btn btn-success" *ngIf="user.getPropertyNb('alliance') == 0"
                       title="{{'Join the alliance:'|translate}} {{alli.alliance_name}}"
                       data-bs-toggle="modal" data-bs-target="#AllianceJoin"
                       (click)="setAlliance(alli)"
                       [ngClass]="{'btn-invisible': alli.recruitement_open == 0}">
                      <ic-icon [icon]="userPlus"></ic-icon>
                      <span class="visually-hidden">
                        {{'Join the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    
                    <br class="d-lg-none"
                        *ngIf="user.getPropertyNb('strategist') > 0" />
                    
                    <a class="btn btn-success" 
                       *ngIf="user.getPropertyNb('strategist') > 0 && user.getPropertyNb('alliance') > 0 && alli.pact == 0 && user.getPropertyNb('alliance') != alli.alliance_id"
                       data-bs-toggle="modal" data-bs-target="#AlliancePactAsk"
                       (click)="setAlliance(alli)"
                       title="{{'Request a pact to the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="flag"></ic-icon>
                      <span class="visually-hidden">
                        {{'Request a pact to the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-info" 
                       *ngIf="user.getPropertyNb('strategist') >0 && user.getPropertyNb('alliance') > 0 && alli.pact == 1"
                       data-bs-toggle="modal" data-bs-target="#AlliancePactManage"
                       (click)="setAlliance(alli)"
                       title="{{'Cancel a pact request with the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="flag"></ic-icon>
                      <span class="visually-hidden">
                        {{'Cancel a pact request with the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-warning" 
                       *ngIf="user.getPropertyNb('strategist') >0 && user.getPropertyNb('alliance') > 0 && alli.pact == 2"
                       data-bs-toggle="modal" data-bs-target="#AlliancePactManage"
                       (click)="setAlliance(alli)"
                       title="{{'Accept/Refuse a pact request from the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="flag"></ic-icon>
                      <span class="visually-hidden">
                        {{'Accept/Refuse a pact request from the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-primary" 
                       *ngIf="user.getPropertyNb('strategist') >0 && 
                              user.getPropertyNb('alliance') > 0 && alli.pact == 3 && 
                              user.getPropertyNb('alliance') != alli.alliance_id"
                       data-bs-toggle="modal" data-bs-target="#AlliancePactManage"
                       (click)="setAlliance(alli)"
                       title="{{'Break the pact with the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="flag"></ic-icon>
                      <span class="visually-hidden">
                        {{'Break the pact with the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-danger"
                       *ngIf="user.getPropertyNb('strategist') >0 && user.getPropertyNb('alliance') == alli.alliance_id"
                       data-bs-toggle="modal" data-bs-target="#AlliancePactAsk"
                       (click)="setAlliance(alli)">
                      <ic-icon [icon]="flag"></ic-icon>
                      <span class="visually-hidden">
                        {{alli.alliance_name}}
                      </span>
                    </a>
                    
                    <a class="btn btn-danger" 
                       *ngIf="user.getPropertyNb('strategist') > 0 && user.getPropertyNb('alliance') > 0 && alli.war == 0"
                       data-bs-toggle="modal" data-bs-target="#AllianceWarDeclare"
                       (click)="setAlliance(alli)"
                       title="{{'Impossible to declare a war to the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="swordIcon"></ic-icon>
                      <span class="visually-hidden">
                        {{'Impossible to declare a war to the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                    <a class="btn btn-success" 
                       *ngIf="user.getPropertyNb('strategist') >0 && user.getPropertyNb('alliance') > 0 && alli.war > 0"
                       data-bs-toggle="modal" data-bs-target="#AllianceWarDeclare"
                       (click)="setAlliance(alli)"
                       title="{{'Declare war to the alliance:'|translate}} {{alli.alliance_name}}">
                      <ic-icon [icon]="swordIcon"></ic-icon>
                      <span class="visually-hidden">
                        {{'Declare war to the alliance:'|translate}} {{alli.alliance_name}}
                      </span>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div class="text-center" *ngIf="!allianceList" translate>
              There is no alliance available currently
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<connected-right-menu></connected-right-menu>
<common-bottom-bar></common-bottom-bar>
