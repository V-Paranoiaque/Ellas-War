<div class="chat-text" *ngIf="chatActive !== ''">
  <div class="row d-md-none">
    <div class="col-12 chat-shortcut text-end">
      <app-ic-icon [icon]="comments" role="button"
              *ngIf="user.getPropertyNb('chat_allowed') === 1"
              (click)="set('general_text')"
              class="text-primary ms-3"></app-ic-icon>
      <app-ic-icon [icon]="users" role="button"
              *ngIf="user.getPropertyNb('chat_allowed') === 1"
              (click)="set('general_members')"
              class="text-primary ms-3"></app-ic-icon>
      <app-ic-icon [icon]="comments" role="button"
              *ngIf="user.getPropertyNb('alliance') > 0"
              (click)="set('alliance_text')"
              class="text-success ms-3"></app-ic-icon>
      <app-ic-icon [icon]="users" role="button"
              *ngIf="user.getPropertyNb('alliance') > 0"
              (click)="set('alliance_members')"
              class="text-success ms-3"></app-ic-icon>
      <app-ic-icon [icon]="times" role="button"
              (click)="toggle(chatActive)"
              class="text-danger ms-3 me-1"></app-ic-icon>
    </div>
  </div>
  <div class="chat-general row"
      [ngClass]="{'d-none': !chatActive.startsWith('general')}">
    <div class="col-lg-10 col-md-9 col-12 chat-inner"
        [ngClass]="{'d-none d-md-block': chatActive !== 'general_text'}" #chatGeneral>
      <div *ngFor="let msg of chat_user_msgs">
        <a [routerLink]="['/profile/'+msg.user_id]" 
           [ngClass]="{'text-danger': msg.rank === 5 }"
           title="{{ msg.time*1000| date:'dd/MM, HH:mm'}}"
           class="fw-bold">{{msg.username}}</a>
        <span translate>:</span>
        {{msg.msg}}<br/>
      </div>
    </div>
    <div class="col-lg-2 col-md-3 col-12 chat-players"
        [ngClass]="{'d-none d-md-block': chatActive !== 'general_members'}">
      <span *ngFor="let user of chat_user_players"
            class="chat-player">
        <a [routerLink]="['/profile/'+user.user_id]" 
           [ngClass]="{'text-danger': user.rank === 5,
                      'text-warning': user.chat_allowed === 0}"
           class="fw-bold">{{user.username}}</a>
      </span>
    </div>
    <div class="col-12" [ngClass]="{'d-none d-md-block': chatActive !== 'general_text'}">
      <div class="input-group" *ngIf="user.getPropertyNb('chat_allowed') === 1">
        <input type="text" aria-describedby="chat_user_input"
               placeholder="{{'Message'|translate}}" class="form-control"
               id="chatUserMsg" [(ngModel)]="chatUserMsg"
               autcomplete="false" data-lpignore="true"
               (keydown.enter)="chatUserSend()">
        <span id="chat_user_input" class="input-group-addon btn btn-primary"
              role="button" (click)="chatUserSend()" translate>Send</span>
      </div>
    </div>
    <div *ngIf="user.getPropertyNb('chat_allowed') === 0"
         class="text-center text-danger fw-bold">
      <br/>
      <span translate>
        You are not allowed to write on the chat
      </span>
    </div>
  </div>
  <div class="chat-alliance row d-none" *ngIf="user.getPropertyNb('alliance') > 0"
      [ngClass]="{'d-none': !chatActive.startsWith('alliance')}">
    <div class="col-lg-10 col-md-9 col-12 chat-inner"
    [ngClass]="{'d-none d-md-block': chatActive !== 'alliance_text'}" #chatAlliance>
      <div *ngFor="let msg of chat_alli_msgs">
        <a [routerLink]="['/profile/'+msg.user_id]" 
           [ngClass]="{'text-danger fw-bold': msg.rank === 5 }"
           title="{{ msg.time*1000| date:'dd/MM, HH:mm'}}"
           class="fw-bold">{{msg.username}}</a>
        <span translate>:</span>
        {{msg.msg}}<br/>
      </div>
    </div>
    <div class="col-lg-2 col-md-3 col-12 chat-players"
        [ngClass]="{'d-none d-md-block': chatActive !== 'alliance_members'}">
      <span *ngFor="let user of chat_alli_players"
            class="chat-player">
        <a [routerLink]="['/profile/'+user.user_id]" 
           [ngClass]="{'text-danger': user.rank === 5,
                      'text-warning': user.chat_allowed === 0}"
           class="fw-bold">{{user.username}}</a>
      </span>
    </div>
    <div class="col-12" [ngClass]="{'d-none d-md-block': chatActive !== 'alliance_text'}">
      <div class="input-group">
        <input type="text" aria-describedby="chat_alliance_input"
               placeholder="{{'Message'|translate}}" class="form-control"
               id="chatAlliMsg" [(ngModel)]="chatAlliMsg"
               autcomplete="false" data-lpignore="true"
               (keydown.enter)="chatAlliSend()">
        <span id="chat_alliance_input" class="input-group-addon btn btn-success"
              role="button" (click)="chatAlliSend()" translate>Send</span>
      </div>
    </div>
  </div>
</div>

<div role="complementary" [attr.aria-label]="['Access to the chats'|translate]">
  <div class="chat-button" role="tablist">
    <button *ngIf="user.getPropertyNb('alliance') > 0" role="tab"
            class="btn btn-success" (click)="toggle('alliance_text')">
      <span translate>Alliance Chat</span>
      <span *ngIf="chat_alli_nb > 0">
        ({{chat_alli_nb}})
      </span>
    </button>
    <button class="btn btn-primary" (click)="toggle('general_text')" role="tab">
      <span translate>General Chat</span>
      <span *ngIf="chat_user_nb > 0">
        ({{chat_user_nb}})
      </span>
    </button>
    <a href="{{ environment.discord }}" target="_blank" id="discord"
       rel="external nofollow noopener" class="btn" role="tab">
      <app-ic-icon [icon]="discordIcon" role="button"></app-ic-icon>
    </a>
  </div>
</div>

<div class="chat-button-mobile" *ngIf="chatActive.length === 0">
  <app-ic-icon [icon]="comments" role="button"
           title="{{'Access to the chats'|translate}}"
           (click)="chatOpenMobile()"></app-ic-icon>
</div>

<div class="bottom-button">
  <div class="d-flex text-center">
    <a [routerLink]="['/city']"
       title="{{'Access to your city'|translate}}"
       [ngClass]="{'inactive': router.url !== '/city',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-city"></app-ew-icon>
    </a>
    <a [routerLink]="['/attacks']"
       title="{{'Access to the attacks'|translate}}"
       [ngClass]="{'inactive': router.url !== '/attacks',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-attack"></app-ew-icon>
    </a>
    <a [routerLink]="['/messages']" 
       title="{{'Access to your messages'|translate}}"
       [ngClass]="{'inactive': router.url !== '/messages',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-messages"></app-ew-icon>
    </a>
    <a [routerLink]="['/quests']"
       title="{{'Access to the quests'|translate}}"
       [ngClass]="{'inactive': router.url !== '/quests',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-quests"></app-ew-icon>
    </a>
    <a [routerLink]="['/diplomacy']"
       *ngIf="user.getPropertyNb('alliance') === 0"
       title="{{'Access to the alliance list'|translate}}"
       [ngClass]="{'inactive': router.url !== '/diplomacy',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-alliance"></app-ew-icon>
    </a>
    <a [routerLink]="['/alliance']"
       *ngIf="user.getPropertyNb('alliance') > 0"
       title="{{'Access to the alliance list'|translate}}"
       [ngClass]="{'inactive': router.url !== '/alliance',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-alliance"></app-ew-icon>
    </a>
    <a [routerLink]="['/storeroom']"
       title="{{'Access to the agora'|translate}}"
       [ngClass]="{'inactive': router.url !== '/storeroom',
                   'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-agora"></app-ew-icon>
    </a>
    <a role="button" data-bs-toggle="modal" data-bs-target="#PlayerInfo"
       title="{{'Display your resources'|translate}}"
       [ngClass]="{'menu-5': user.getLevel() === 0,
                   'menu-7': user.getLevel() > 0}">
      <app-ew-icon name="menu-resources"></app-ew-icon>
    </a>
  </div>
</div>

<div class="mosaic"></div>
