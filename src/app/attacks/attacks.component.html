<app-attacks-help-popup></app-attacks-help-popup>
<app-attacks-unit-help-popup></app-attacks-unit-help-popup>
<app-attacks-spy-resources-help-popup></app-attacks-spy-resources-help-popup>

<app-main-left></app-main-left>

<main class="mb-4">
  <div class="container">
    @if (
      Object.keys(realWaveAttackCheck.ress).length > 0 ||
      realWaveAttackCheckHabitation() > 0
    ) {
      <div class="row">
        <div class="col-12 mt-1">
          <div class="text-center alert alert-danger">
            @if (Object.keys(realWaveAttackCheck.ress).length > 0) {
              <div>
                <span translate>
                  You do not have enough resources, the units of your waves can
                  not fight.
                </span>
                <br />
                @for (res of realWaveAttackCheck.ress | keyvalue; track res) {
                  <span>
                    <app-ew-icon
                      name="{{ res.key }}"
                      class="small-resource"></app-ew-icon>
                  </span>
                }
              </div>
            }
            @if (Object.keys(realWaveAttackCheck.habitation).length > 0) {
              <div>
                @if (realWaveAttackCheck.habitation.normal) {
                  <div translate>You do not have enough huts and houses.</div>
                }
                @if (realWaveAttackCheck.habitation.palace) {
                  <div translate>You do not have enough palaces.</div>
                }
                @if (realWaveAttackCheck.habitation.cavern) {
                  <div translate>You do not have enough caverns.</div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    }

    <div class="row">
      <div class="col-xl-6 mt-1">
        <div class="card">
          <app-attacks-menu></app-attacks-menu>

          @if (getAttackList().length === 0) {
            <div class="card-body text-center">
              <p translate>
                Your attack list is empty. You can only see cities who have
                between 50% and 200% of your field.
              </p>
              @if (user.getPropertyNb('level') >= 1) {
                <div class="text-center fw-bold mb-2">
                  <a [routerLink]="['/strategies/attack']" translate
                    >Manage your waves to optimize your losses</a
                  >
                </div>
              }
              @if (attackSearchError === 1) {
                <div class="text-center fw-bold text-danger">
                  <div translate>No result for your search</div>
                  <a [routerLink]="['/attacks']" translate>Back</a>
                </div>
              } @else if (attackSearchError === 0) {
                <div>
                  <br />
                  <strong id="closestCitiesDesc" translate
                    >Nearest cities</strong
                  >
                  <table class="table" aria-labelledby="closestCitiesDesc">
                    <thead>
                      <tr>
                        <th translate>Name</th>
                        <th translate>Field</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <a
                            [routerLink]="[
                              '/profile/' + attackClosestMin.membre_id,
                            ]"
                            class="no-padding"
                            >{{ attackClosestMin.username }}</a
                          >
                        </td>
                        <td>
                          {{
                            attackClosestMin.field
                              | number: '' : this.translate.getCurrentLang()
                          }}
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <a
                            [routerLink]="[
                              '/profile/' + attackClosestMax.membre_id,
                            ]"
                            class="no-padding"
                            >{{ attackClosestMax.username }}</a
                          >
                        </td>
                        <td>
                          {{
                            attackClosestMax.field
                              | number: '' : this.translate.getCurrentLang()
                          }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              }
            </div>
          } @else {
            <div class="card-body">
              @if (user.getPropertyNb('level') >= 1) {
                <div class="text-center fw-bold mb-2">
                  <a [routerLink]="['/strategies/attack']" translate
                    >Manage your waves to optimize your losses</a
                  >
                </div>
              }
              <div class="visually-hidden" id="getAttackListDesc" translate>
                Attackable cities
              </div>
              <table
                class="table align-middle"
                aria-labelledby="getAttackListDesc">
                <thead>
                  <tr class="text-center">
                    <th scope="col">
                      @if (user.getPropertyNb('level') >= 1) {
                        <div class="input-group input-group-sm">
                          <input
                            type="text"
                            class="form-control"
                            placeholder="{{ 'Look for a city' | translate }}"
                            [(ngModel)]="attackSearchText"
                            attr.aria-label="{{
                              'Look for a city' | translate
                            }}"
                            aria-describedby="attack-search" />
                          <span
                            class="input-group-text"
                            id="attack-search"
                            (click)="attackSearch()"
                            role="button"
                            (keyup.enter)="attackSearch()"
                            tabindex="0">
                            <app-ic-icon [icon]="search"></app-ic-icon>
                          </span>
                        </div>
                      }
                    </th>
                    <th
                      scope="col"
                      class="d-none d-sm-table-cell"
                      (click)="setOrder('victory')"
                      role="button">
                      <span translate>V</span>
                      @if (
                        attackOrderReverse === 0 &&
                        attackOrderSort === 'victory'
                      ) {
                        <app-ic-icon
                          title="{{ 'Current order' | translate }}"
                          [icon]="sortDown"></app-ic-icon>
                      }
                      @if (
                        attackOrderReverse === 1 &&
                        attackOrderSort === 'victory'
                      ) {
                        <app-ic-icon
                          title="{{ 'Current order' | translate }}"
                          [icon]="sortUP"></app-ic-icon>
                      }
                    </th>
                    @if (
                      user.getDatas() &&
                      user.getDatas().attack &&
                      user.getPropertyNb('level') >=
                        user.getDatas().attack.level_xp_min
                    ) {
                      <th scope="col" (click)="setOrder('xp')" role="button">
                        <span translate>XP</span>
                        @if (
                          attackOrderReverse === 0 && attackOrderSort === 'xp'
                        ) {
                          <app-ic-icon
                            title="{{ 'Current order' | translate }}"
                            [icon]="sortDown"></app-ic-icon>
                        }
                        @if (
                          attackOrderReverse === 1 && attackOrderSort === 'xp'
                        ) {
                          <app-ic-icon
                            title="{{ 'Current order' | translate }}"
                            [icon]="sortUP"></app-ic-icon>
                        }
                      </th>
                    }
                    <th scope="col" (click)="setOrder('field')" role="button">
                      <span translate>Field</span>
                      @if (
                        attackOrderReverse === 0 && attackOrderSort === 'field'
                      ) {
                        <app-ic-icon
                          title="{{ 'Current order' | translate }}"
                          [icon]="sortDown"></app-ic-icon>
                      }
                      @if (
                        attackOrderReverse === 1 && attackOrderSort === 'field'
                      ) {
                        <app-ic-icon
                          title="{{ 'Current order' | translate }}"
                          [icon]="sortUP"></app-ic-icon>
                      }
                    </th>
                    <th scope="col">
                      @if (user.getPropertyNb('level') >= 1) {
                        <span
                          data-bs-toggle="modal"
                          data-bs-target="#attacksHelp"
                          role="button"
                          title="{{ 'Help' | translate }}">
                          <app-ic-icon [icon]="questionCircle"></app-ic-icon>
                        </span>
                      }
                    </th>
                  </tr>
                </thead>
                <tbody>
                  @for (player of getAttackList(); track player) {
                    <tr>
                      <td>
                        <a
                          [routerLink]="['/profile/' + player.membre_id]"
                          class="no-padding">
                          {{ player.username }}
                          @if (user.getPropertyNb('level') > 0) {
                            <span>({{ player.level }})</span>
                          }
                        </a>
                        @if (player.diamond_begin > 0) {
                          <app-ic-icon [icon]="gemIcon"></app-ic-icon>
                        }
                        @if (player.alliance > 0) {
                          <a
                            [routerLink]="[
                              '/allianceprofile/' + player.alliance,
                            ]"
                            class="fw-lighter no-padding">
                            <br />
                            {{ player.alliance_name }}
                          </a>
                        }
                      </td>
                      <td class="d-none d-sm-table-cell text-end">
                        {{
                          player.victory
                            | number: '' : this.translate.getCurrentLang()
                        }}
                      </td>
                      @if (
                        user.getDatas() &&
                        user.getDatas().attack &&
                        user.getPropertyNb('level') >=
                          user.getDatas().attack.level_xp_min
                      ) {
                        <td class="text-end">
                          {{
                            player.xp
                              | number: '' : this.translate.getCurrentLang()
                          }}
                        </td>
                      }
                      <td class="text-end">
                        {{
                          player.field
                            | number: '' : this.translate.getCurrentLang()
                        }}
                      </td>
                      <td class="text-center">
                        @if (
                          user.getPropertyNb('apollo') === 0 &&
                          user.getPropertyNb('level') > 0
                        ) {
                          <button
                            class="btn btn-info"
                            (click)="spy(player.membre_id)">
                            <app-ic-icon [icon]="bleedingEyes"></app-ic-icon>
                          </button>
                        }
                        @if (user.getPropertyNb('apollo') === 1) {
                          <button
                            class="btn btn-primary"
                            (click)="observe(player.membre_id)">
                            <app-ic-icon [icon]="gooeyEyedSun"></app-ic-icon>
                          </button>
                        }
                        @if (user.getPropertyNb('demeter') === 1) {
                          <button
                            class="btn"
                            [ngClass]="{
                              'btn-danger': player.fury_allowed === 0,
                              'btn-success': player.fury_allowed === 1,
                            }"
                            (click)="prepareFury(player.membre_id)">
                            <app-ic-icon [icon]="fireIcon"></app-ic-icon>
                          </button>
                        }
                        @if (
                          user.getPropertyNb('demeter') === 1 &&
                          user.getPropertyNb('zeus') === 1
                        ) {
                          <br />
                        }
                        @if (user.getPropertyNb('zeus') === 1) {
                          <button
                            class="btn"
                            [ngClass]="{
                              'btn-danger': player.lightning_allowed === 0,
                              'btn-success': player.lightning_allowed === 1,
                            }"
                            (click)="prepareLightning(player.membre_id)">
                            <app-ic-icon [icon]="boltIcon"></app-ic-icon>
                          </button>
                        }
                        <button
                          class="btn"
                          [ngClass]="{
                            'btn-danger': player.attack_allowed === 0,
                            'btn-success': player.attack_allowed === 1,
                          }"
                          (click)="prepareAttack(player.membre_id)">
                          <app-ic-icon [icon]="swordIcon"></app-ic-icon>
                        </button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
              @if (getAttacksPageNb() > 1) {
                <div class="input-group">
                  <span
                    class="input-group-text"
                    role="button"
                    (click)="setAttacksPage(1)"
                    (keyup.enter)="setAttacksPage(1)"
                    tabindex="0"
                    >&lt;&lt;</span
                  >
                  <span
                    class="input-group-text"
                    role="button"
                    (click)="setAttacksPage(attackPage, -1)"
                    (keyup.enter)="setAttacksPage(attackPage, -1)"
                    tabindex="0"
                    >&lt;</span
                  >
                  <select
                    class="form-select"
                    (change)="pageAttacksLoad($event)"
                    [(ngModel)]="attackPage">
                    @for (
                      item of [].constructor(getAttacksPageNb());
                      track item;
                      let i = $index
                    ) {
                      <option value="{{ i + 1 }}" translate>
                        Page {{ i + 1 }}
                      </option>
                    }
                  </select>
                  <span
                    class="input-group-text"
                    role="button"
                    (click)="setAttacksPage(attackPage, 1)"
                    (keyup.enter)="setAttacksPage(attackPage, 1)"
                    tabindex="0"
                    >&gt;</span
                  >
                  <span
                    class="input-group-text"
                    role="button"
                    (click)="setAttacksPage(getAttacksPageNb())"
                    (keyup.enter)="setAttacksPage(getAttacksPageNb())"
                    tabindex="0"
                    >&gt;&gt;</span
                  >
                </div>
              }
            </div>
          }
        </div>
      </div>
      @if (attackMode === 0) {
        <app-attacks-history class="col-xl-6 mt-1"></app-attacks-history>
      } @else {
        <div class="col-xl-6 mt-1">
          <div class="card card-normal">
            @if (targetProfile.username) {
              <div class="card-header card-header-flexible">
                <h2 id="playerDesc">
                  {{ targetProfile.username }}
                  @if (targetProfile.diamond_begin > 0) {
                    <app-ic-icon [icon]="gemIcon"></app-ic-icon>
                  }
                </h2>
              </div>
            }
            <!-- Observe/Spy -->
            @if (attackMode === 1 || attackMode === 2) {
              <div class="card-body" id="attackEyeBlock">
                <table aria-describedby="playerDesc" class="m-auto">
                  @if (targetProfile.alliance > 0) {
                    <tr>
                      <th scope="row" translate>Alliance</th>
                      <td>{{ targetProfile.alliance_name }}&nbsp;</td>
                    </tr>
                  }
                  @if (targetProfile.alliance > 0) {
                    <tr>
                      <th scope="row" translate>Rank</th>
                      <td>{{ targetProfile.rank_name }}&nbsp;</td>
                    </tr>
                  }
                  <tr>
                    <th scope="row" translate>Level</th>
                    <td>{{ targetProfile.level }}&nbsp;</td>
                  </tr>
                  <tr>
                    <th scope="row" translate>Field</th>
                    <td>
                      {{
                        targetProfile.field
                          | number: '' : this.translate.getCurrentLang()
                      }}
                    </td>
                  </tr>
                  <tr>
                    <th scope="row" class="pe-1" translate>Victories</th>
                    <td>
                      {{
                        targetProfile.victory
                          | number: '' : this.translate.getCurrentLang()
                      }}
                    </td>
                  </tr>
                  <tr>
                    <th scope="row" translate>XP</th>
                    <td>
                      {{
                        targetProfile.xp
                          | number: '' : this.translate.getCurrentLang()
                      }}
                    </td>
                  </tr>
                </table>
                @if (spyInfo) {
                  <div>
                    <br />
                    <span class="text-center">
                      @switch (spyInfo.error) {
                        @case (1) {
                          <div translate>
                            Your espionage team was caught and executed in a
                            public place.
                          </div>
                        }
                        @case (2) {
                          <div translate>
                            Information reached your city but unfortunately your
                            spy team was caught, tortured until they denounce
                            you and executed in a public place.
                          </div>
                        }
                        @case (4) {
                          <div class="text-center" translate>
                            You do not have spies.
                          </div>
                        }
                      }
                    </span>
                    @if (
                      spyInfo.poseidon_wall &&
                      spyInfo.poseidon_wall === 1 &&
                      (!spyInfo.defense_wall || spyInfo.defense_wall === 0)
                    ) {
                      <div class="text-center" translate>
                        The wall of Poseidon protects this city.
                      </div>
                    }
                    @if (
                      spyInfo.defense_wall &&
                      spyInfo.defense_wall >= 1 &&
                      (!spyInfo.poseidon_wall || spyInfo.poseidon_wall === 0)
                    ) {
                      <div class="text-center" translate>
                        A wall is protecting this city.
                      </div>
                    }
                    @if (
                      spyInfo.defense_wall &&
                      spyInfo.defense_wall >= 1 &&
                      spyInfo.poseidon_wall &&
                      spyInfo.poseidon_wall === 1
                    ) {
                      <div class="text-center" translate>
                        Many walls are protecting this city.
                      </div>
                    }
                    @if (Object.keys(spyInfo).length > 0) {
                      <div class="text-center">
                        @if (
                          !isProtected() && [0, 2, 3].includes(spyInfo.error)
                        ) {
                          <div translate>
                            This city is not protected by any units or defense
                            towers
                          </div>
                        }
                        @if (spyInfo.unitiesNb > 0) {
                          <div>
                            <strong translate>Unities</strong
                            ><strong translate>:</strong>
                            {{
                              spyInfo.unitiesNb
                                | number: '' : this.translate.getCurrentLang()
                            }}
                            <br />
                          </div>
                        }
                        @if (spyInfo.defenseNb > 0) {
                          <div>
                            <strong translate>Towers</strong
                            ><strong translate>:</strong>
                            {{
                              spyInfo.defenseNb
                                | number: '' : this.translate.getCurrentLang()
                            }}
                            <br />
                          </div>
                        }
                        <br />
                        @if (
                          spyInfo.buildings && spyInfo.buildings.length > 0
                        ) {
                          <div>
                            <strong translate>Buildings</strong
                            ><strong translate>:</strong>
                            @for (build of spyInfo.buildings; track build) {
                              <div>
                                {{ Tools.getName(build) | translate }}
                              </div>
                            }
                          </div>
                        }
                        @if (spyInfo.unities && spyInfo.unities.length > 0) {
                          <div>
                            <strong translate>Unities</strong
                            ><strong translate>:</strong>
                            @for (unit of spyInfo.unities; track unit) {
                              <div>
                                {{
                                  Tools.getName(unit, 1, spyInfo.defenseType)
                                    | translate
                                }}
                              </div>
                            }
                            <br />
                          </div>
                        }
                        @if (spyInfo.ress && spyInfo.ress.food) {
                          <div class="col-table center">
                            <br />
                            <strong translate>Resources</strong>
                            <strong translate>:</strong>
                            <span
                              data-bs-toggle="modal"
                              data-bs-target="#spyResourcesHelp"
                              role="button"
                              title="{{ 'Help' | translate }}">
                              <app-ic-icon
                                [icon]="questionCircle"></app-ic-icon>
                            </span>
                            <br />
                            <div class="row">
                              <div class="col-4">
                                <app-ew-icon
                                  name="food"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.food === 1,
                                    low: spyInfo.ress.food === 2,
                                    middle: spyInfo.ress.food === 3,
                                    high: spyInfo.ress.food === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="water"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.water === 1,
                                    low: spyInfo.ress.water === 2,
                                    middle: spyInfo.ress.water === 3,
                                    high: spyInfo.ress.water === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="wood"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.wood === 1,
                                    low: spyInfo.ress.wood === 2,
                                    middle: spyInfo.ress.wood === 3,
                                    high: spyInfo.ress.wood === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="iron"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.iron === 1,
                                    low: spyInfo.ress.iron === 2,
                                    middle: spyInfo.ress.iron === 3,
                                    high: spyInfo.ress.iron === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="stone"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.stone === 1,
                                    low: spyInfo.ress.stone === 2,
                                    middle: spyInfo.ress.stone === 3,
                                    high: spyInfo.ress.stone === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="marble"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.marble === 1,
                                    low: spyInfo.ress.marble === 2,
                                    middle: spyInfo.ress.marble === 3,
                                    high: spyInfo.ress.marble === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="grapes"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.grapes === 1,
                                    low: spyInfo.ress.grapes === 2,
                                    middle: spyInfo.ress.grapes === 3,
                                    high: spyInfo.ress.grapes === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="wine"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.wine === 1,
                                    low: spyInfo.ress.wine === 2,
                                    middle: spyInfo.ress.wine === 3,
                                    high: spyInfo.ress.wine === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                              <div class="col-4">
                                <app-ew-icon
                                  name="gold"
                                  class="small-resource"></app-ew-icon>
                                &nbsp;
                                <app-ic-icon
                                  [ngClass]="{
                                    vlow: spyInfo.ress.gold === 1,
                                    low: spyInfo.ress.gold === 2,
                                    middle: spyInfo.ress.gold === 3,
                                    high: spyInfo.ress.gold === 4,
                                  }"
                                  [icon]="dotCircle"></app-ic-icon>
                              </div>
                            </div>
                          </div>
                        }
                      </div>
                    }
                    <div class="text-center">
                      <br />
                      <button
                        class="btn btn-info fs-5"
                        (click)="spy(targetProfile.membre_id)"
                        title="{{ 'Send a spy to the city:' | translate }} {{
                          targetProfile.username
                        }}">
                        <app-ic-icon [icon]="bleedingEyes"></app-ic-icon>
                        <span class="visually-hidden">
                          {{ 'Send a spy to the city:' | translate }}
                          {{ targetProfile.username }}
                        </span>
                      </button>
                      @if (user.getPropertyNb('apollo') === 1) {
                        <button
                          class="btn btn-primary fs-5"
                          (click)="observe(targetProfile.membre_id)"
                          title="{{ 'Observe the city:' | translate }} {{
                            targetProfile.username
                          }}">
                          <app-ic-icon [icon]="gooeyEyedSun"></app-ic-icon>
                          <span class="visually-hidden">
                            {{ 'Observe the city:' | translate }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (
                        user.getPropertyNb('demeter') === 1 &&
                        furyPossible === 1
                      ) {
                        <button
                          class="btn btn-success fs-5"
                          (click)="prepareFury(targetProfile.membre_id)"
                          title="{{
                            'Launch a fury on the city:' | translate
                          }} {{ targetProfile.username }}">
                          <app-ic-icon [icon]="fireIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{ 'Launch a fury on the city:' | translate }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (
                        user.getPropertyNb('demeter') === 1 &&
                        furyPossible === 0
                      ) {
                        <button
                          class="btn btn-danger fs-5"
                          title="{{
                            'Impossible to launch a fury on the city:'
                              | translate
                          }} {{ targetProfile.username }}">
                          <app-ic-icon [icon]="fireIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{
                              'Impossible to launch a fury on the city:'
                                | translate
                            }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (
                        user.getPropertyNb('zeus') === 1 &&
                        lightningPossible === 1
                      ) {
                        <button
                          class="btn btn-success fs-5"
                          (click)="prepareLightning(targetProfile.membre_id)"
                          title="{{
                            'Launch a lightning on the city:' | translate
                          }} {{ targetProfile.username }}">
                          <app-ic-icon [icon]="boltIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{ 'Launch a lightning on the city:' | translate }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (
                        user.getPropertyNb('zeus') === 1 &&
                        lightningPossible === 0
                      ) {
                        <button
                          class="btn btn-danger fs-5"
                          title="{{
                            'Impossible to launch a lightning on the city:'
                              | translate
                          }} {{ targetProfile.username }}">
                          <app-ic-icon [icon]="boltIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{
                              'Impossible to launch a lightning on the city:'
                                | translate
                            }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (attackPossible > 0) {
                        <button
                          class="btn btn-success fs-5"
                          (click)="prepareAttack(targetProfile.membre_id)"
                          title="{{ 'Attack the city:' | translate }} {{
                            targetProfile.username
                          }}">
                          <app-ic-icon [icon]="swordIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{ 'Attack the city:' | translate }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                      @if (attackPossible === 0) {
                        <button
                          class="btn btn-danger fs-5"
                          title="{{
                            'Impossible to attack the city:' | translate
                          }} {{ targetProfile.username }}">
                          <app-ic-icon [icon]="swordIcon"></app-ic-icon>
                          <span class="visually-hidden">
                            {{ 'Impossible to attack the city:' | translate }}
                            {{ targetProfile.username }}
                          </span>
                        </button>
                      }
                    </div>
                  </div>
                }
                @if (attackPossible <= 0) {
                  <div class="text-center fw-bold text-danger">
                    <br />
                    <div>
                      @switch (attackPossibleError) {
                        @case (2) {
                          <div translate>Your army is empty</div>
                        }
                        @case (3) {
                          <div translate>Error in the target</div>
                        }
                        @case (4) {
                          <div translate>
                            You can't attack a player who is in the same
                            alliance than you
                          </div>
                        }
                        @case (5) {
                          <div translate>
                            You don't have enough mints to launch an attack
                          </div>
                        }
                        @case (7) {
                          <div translate>
                            This city's field has changed, refresh your attack
                            list
                          </div>
                        }
                        @case (8) {
                          <div translate>You can't attack an Admin</div>
                        }
                        @case (9) {
                          <div translate>
                            This player is too low level for you
                          </div>
                        }
                        @case (10) {
                          <div translate>
                            You have already attacked this player
                          </div>
                        }
                        @case (11) {
                          <div translate>
                            You have a pact with this player's alliance
                          </div>
                        }
                        @case (12) {
                          <div translate>
                            This city has suffered a lot, it needs time to
                            recover
                          </div>
                        }
                        @case (13) {
                          <div translate>
                            This city is on strike and can't be attacked
                          </div>
                        }
                        @case (14) {
                          <div translate>
                            You are on strike, you can't attack in war
                          </div>
                        }
                        @case (15) {
                          <div translate>
                            You are in trial period, you can't attack during a
                            war
                          </div>
                        }
                        @case (16) {
                          <div translate>
                            You don't have war attacks available
                          </div>
                        }
                        @case (17) {
                          <div translate>
                            This city has too much or not enoug field
                          </div>
                        }
                        @case (18) {
                          <div translate>
                            This city has received too many war attacks
                          </div>
                        }
                        @case (19) {
                          <div translate>The level of this city is too low</div>
                        }
                        @case (20) {
                          <div translate>
                            The level of this city is too high
                          </div>
                        }
                        @case (21) {
                          <div translate>Your army is empty</div>
                        }
                        @case (22) {
                          <div translate>This city's field is too high</div>
                        }
                        @case (23) {
                          <div translate>This city's field is too low</div>
                        }
                        @case (24) {
                          <div translate>This city's level is too high</div>
                        }
                        @case (25) {
                          <div translate>
                            This city has received too many attacks
                          </div>
                        }
                        @case (26) {
                          <div translate>Your army is empty</div>
                        }
                        @case (27) {
                          <div translate>Your army is empty</div>
                        }
                        @case (28) {
                          <div translate>
                            You have used all your available attacks
                          </div>
                        }
                        @case (29) {
                          <div translate>Artemis is protecting this city</div>
                        }
                        @default {
                          <div>{{ attackPossibleError }}</div>
                        }
                      }
                    </div>
                  </div>
                }
              </div>
            }
            <!-- Prepare to attack -->
            @if (attackMode === 3) {
              <div class="card-body" id="attackPrepareBlock">
                <div class="text-center">
                  @if (attackPossible > 0) {
                    <button
                      class="btn btn-primary fs-5"
                      (click)="launchAttack(targetProfile.membre_id)">
                      <app-ic-icon [icon]="swordIcon"></app-ic-icon>
                      &nbsp;<span translate>Attack</span>
                    </button>
                  }
                  @if (attackPossible === 0) {
                    <div translate>You can't attack this city</div>
                  }
                </div>
                @if (getArmy().length > 0) {
                  <div class="text-center">
                    <br />
                    <strong translate>Army summary</strong>
                    @for (i of getArmy(); track i) {
                      <div>
                        <span [ngClass]="{ 'text-danger': i.all === 0 }">
                          {{
                            i.nb | number: '' : this.translate.getCurrentLang()
                          }}
                          {{ Tools.getName(i.unit, i.nb) | translate }}
                          @if (i.all === 0) {
                            <span
                              data-bs-toggle="modal"
                              data-bs-target="#attacksUnitHelp"
                              role="button"
                              title="{{ 'Help' | translate }}">
                              <app-ic-icon
                                [icon]="questionCircle"></app-ic-icon>
                            </span>
                          }
                        </span>
                      </div>
                    }
                    <br />
                    <strong translate>Offensive power</strong>
                    <strong translate>:</strong>
                    {{
                      getOffensivePower()
                        | number: '' : this.translate.getCurrentLang()
                    }}
                  </div>
                }
                @if (getArmy().length === 0) {
                  <div class="text-center" translate>Your army is empty</div>
                }
              </div>
            }
            <!-- Result from an attack -->
            @if (attackMode === 4) {
              <div class="card-body text-center">
                <app-attacks-message
                  [info]="attackInfo.content"></app-attacks-message>
              </div>
            }
            <!-- Prepare to send a fury -->
            @if (attackMode === 5) {
              <div class="card-body text-center" id="furyPrepareBlock">
                <div translate>
                  The fury can destroy farms and growers and reserves of grapes
                  and food of your opponents.
                </div>
                <br />
                <br />
                @if (user.getPropertyNb('fury') > 0 && furyPossible === 1) {
                  <button
                    class="btn btn-primary"
                    (click)="launchFury(targetProfile.membre_id)">
                    <app-ic-icon [icon]="fireIcon"></app-ic-icon>
                    &nbsp;<span translate>Send</span>
                  </button>
                } @else {
                  <div class="fw-bold text-danger" translate>
                    You have no furies in stock. Go to the Temple of Demeter to
                    get some.
                  </div>
                }
              </div>
            }
            <!-- Result from a fury -->
            @if (attackMode === 6) {
              <div class="card-body text-center">
                <app-fury-message [info]="furyInfo.content"></app-fury-message>
              </div>
            }
            <!-- Prepare to send a lightning -->
            @if (attackMode === 7) {
              <div class="card-body text-center" id="lightningPrepareBlock">
                <div translate>
                  The lightning can destroy the buildings of your opponents,
                  including mints.
                </div>
                <br />
                <br />
                @if (
                  user.getPropertyNb('lightning') > 0 && lightningPossible === 1
                ) {
                  <button
                    class="btn btn-primary"
                    (click)="launchLightning(targetProfile.membre_id)">
                    <app-ic-icon [icon]="boltIcon"></app-ic-icon>
                    &nbsp;<span translate>Send</span>
                  </button>
                } @else {
                  <div class="fw-bold text-danger" translate>
                    You have no lightnings in stock. Go to the Temple of Zeus to
                    get some.
                  </div>
                }
              </div>
            }
            <!-- Result from a lightning -->
            @if (attackMode === 8) {
              <div class="card-body text-center">
                <app-lost-message
                  [info]="lightningInfo.content"></app-lost-message>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>
</main>

<app-main-right></app-main-right>
